# üõ°Ô∏è ModerationService

–ú–Ω–µ —Å—Ç–∞–ª–æ —Å–∫—É—á–Ω–æ –∂–∏—Ç—å, –∏ —è —Ä–µ—à–∏–ª –Ω–∞–ø–∏—Å–∞—Ç—å —Å–µ—Ä–≤–∏—Å –ø–æ —ç–º—É–ª—è—Ü–∏–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏.

Kafka –≤–º–µ—Å—Ç–æ –±–∞–∑—ã, –ø–∞–º—è—Ç—å –≤–º–µ—Å—Ç–æ –¥–∏—Å–∫–∞, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ ‚Äî **—á–∏—Å—Ç–∞—è, –∫–∞–∫ —è–π—Ü–∞ –∫–æ—Ç–∞**.  

---

## üéØ –¶–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞

- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∞–º–∏ —á–µ—Ä–µ–∑ REST API
- ‚úÖ Kafka ‚Äî **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ** (–Ω–∏–∫–∞–∫–∏—Ö –ë–î, —Ç–æ–ª—å–∫–æ —Ö–∞—Ä–¥–∫–æ—Ä)
- ‚úÖ In-memory TTL-–∫—ç—à –¥–ª—è "–∂–∏–≤—ã—Ö" –∑–∞—è–≤–æ–∫
- ‚úÖ –û—Ç–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ—ë–≤: handler ‚Üí usecase ‚Üí service ‚Üí adapter
- ‚úÖ DI —á–µ—Ä–µ–∑ `uber-go/fx`, –ø–æ—Ç–æ–º—É —á—Ç–æ –º—ã –Ω–µ –≤ –ø–µ—â–µ—Ä–µ

---

## üß± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```

HTTP (Fiber)
‚îÇ
Handler
‚îÇ
Usecase
‚îÇ
Service
‚îÇ
‚îú‚îÄ‚îÄ KafkaAdapter
‚îî‚îÄ‚îÄ InMemAdapter

````

–ö–∞–∂–¥—ã–π —Å–ª–æ–π –∑–Ω–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ –Ω–∏–∂–µ–ª–µ–∂–∞—â–µ–º. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–µ —Ç–µ–∫—É—Ç –≤–≤–µ—Ä—Ö

---

## üß™ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞—è–≤–∫–∏

1. –ö—Ç–æ-—Ç–æ —Å—Ç—É—á–∏—Ç –≤ `/moderation` ‚Äî –∑–∞—è–≤–∫–∞ —É—Ö–æ–¥–∏—Ç –≤ Kafka
2. –ú–æ–¥–µ—Ä–∞—Ç–æ—Ä –±–µ—Ä—ë—Ç `/moderation/next` ‚Äî –∑–∞—è–≤–∫–∞ –ø–∞—Ä–∫—É–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏
3. `/approve` –∏–ª–∏ `/decline` ‚Äî –æ–Ω–∞ —É—Ö–æ–¥–∏—Ç –≤ –Ω—É–∂–Ω—ã–π —Ç–æ–ø–∏–∫, –∞ –ø–∞–º—è—Ç—å –ø—Ä–æ—â–∞–µ—Ç—Å—è
4. –ï—Å–ª–∏ –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª ‚Äî TTL –µ—ë —Å–æ–∂—Ä—ë—Ç

---

## ‚öôÔ∏è –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
docker-compose up -d    # –ø–æ–¥–Ω–∏–º–∞–µ–º Kafka
go run ./cmd/main.go    # –∑–∞–ø—É—Å–∫–∞–µ–º –∫—Ä–∞—Å–æ—Ç—É
````

–ü–æ—Ä—Ç: `:3000`
–ü—É—Ç—å –∫ –±–ª–∞–∂–µ–Ω—Å—Ç–≤—É: `/api/moderation`

---

## üì° API

| –ú–µ—Ç–æ–¥  | –ü—É—Ç—å                          | –û–ø–∏—Å–∞–Ω–∏–µ                  |
| ------ | ----------------------------- |---------------------------|
| `POST` | `/api/moderation`             | –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É            |
| `GET`  | `/api/moderation/next`        | –í–∑—è—Ç—å —Å–ª–µ–¥—É—é—â—É—é           |
| `POST` | `/api/moderation/:id/approve` | –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å               |
| `POST` | `/api/moderation/:id/decline` | –û—Ç–∫–ª–æ–Ω–∏—Ç—å                 |
| `GET`  | `/health`                     | –ú—ã –∂–∏–≤—ã? –ñ–∏–≤–µ–µ –≤—Å–µ—Ö –∂–∏–≤—ã—Ö |

---

## üì¶ –ö–æ–Ω—Ñ–∏–≥

–§–∞–π–ª: `config.yaml`

```yaml
app:
  name: ModerationService
  version: "1.0"

server:
  port: 3000

kafka:
  broker: localhost:9092
  topics:
    - alias: moderation-requests
      topic: moderation-requests
      group_id: moderator-group
```

---

## ü§Ø –ü–æ—á–µ–º—É –Ω–µ—Ç –ë–î?

–ü–æ—Ç–æ–º—É —á—Ç–æ Kafka ‚Äî —ç—Ç–æ —Ç–æ–∂–µ –±–∞–∑–∞.
–ó–∞—è–≤–∫–∏ –ª–µ–∂–∞—Ç –≤ –ª–æ–≥–∞—Ö, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ offset-–∫–æ–º–º–∏—Ç—ã.
–ï—Å–ª–∏ —Ö–æ—á–µ—à—å durability ‚Äî –∏–¥–∏ –≤ Postgres. –ê —Ç—É—Ç —É—Å–ª–æ–∂–Ω—è—é—â–∏–π —Å–µ–±–µ –∂–∏–∑–Ω—å **—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç**.

---

## üõ† TODO (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —Å—Ç–∞–Ω–µ—Ç –µ—â—ë —Å–∫—É—á–Ω–µ–µ)

* [ ] –¢–µ—Å—Ç—ã, —á—Ç–æ–±—ã –Ω–µ –±–æ—è—Ç—å—Å—è
* [ ] Swagger, —á—Ç–æ–±—ã –∫–∞–∑–∞—Ç—å—Å—è —Å–µ—Ä—å—ë–∑–Ω–µ–µ
* [ ] –ú–µ—Ç—Ä–∏–∫–∏, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å, –∫–∞–∫ –æ–Ω–æ –ø–∞–¥–∞–µ—Ç
* [ ] Graceful shutdown Kafka-–∫–ª–∏–µ–Ω—Ç–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ Ctrl+C ‚Äî –Ω–µ –≤—Å–µ–≥–¥–∞ –º–∏–ª–æ—Å–µ—Ä–¥–µ–Ω

---

## ‚úçÔ∏è –ê–≤—Ç–æ—Ä

Aleksey Sinitsyn
*–ß–µ–ª–æ–≤–µ–∫, –∫–æ—Ç–æ—Ä—ã–π –∑–∞—á–µ–º-—Ç–æ —Ä–µ—à–∏–ª —Å–¥–µ–ª–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–µ–ª–æ—Å–∏–ø–µ–¥*

---
